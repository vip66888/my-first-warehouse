<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“é£æœºæ¸¸æˆæ¦‚ç‡è®¡ç®—å™¨</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .controls {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .grid-container {
            flex: 2;
            min-width: 500px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
        h2 {
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input, button {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            grid-template-rows: repeat(11, 1fr);
            gap: 2px;
            background-color: #ddd;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            font-size: 12px;
            position: relative;
            cursor: pointer;
            user-select: none;
        }
        .cell.header {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .cell.hit {
            background-color: #ff9999;
        }
        .cell.miss {
            background-color: #cccccc;
        }
        .cell.head-hit {
            background-color: #ff3333;
        }
        .probability-indicator {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px solid transparent;
            z-index: 1;
        }
        .probability-value {
            font-size: 10px;
            font-weight: bold;
            z-index: 2;
        }
        .head-marker {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            background-color: #ff9900;
            border-radius: 50%;
            z-index: 3;
        }
        .recommended-area {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px solid #3366ff;
            z-index: 4;
            pointer-events: none;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border: 1px solid #999;
        }
        .info-panel {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .coordinates {
            display: grid;
            grid-template-columns: 30px repeat(10, 1fr);
            grid-template-rows: 30px repeat(10, 1fr);
            gap: 2px;
        }
        .coordinate-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .instructions {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .recommendation-list {
            margin-top: 10px;
        }
        .recommendation-item {
            padding: 5px;
            margin: 2px 0;
            background-color: #f0f8ff;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>æ‰“é£æœºæ¸¸æˆæ¦‚ç‡è®¡ç®—å™¨</h1>
    
    <div class="container">
        <div class="controls">
            <h2>æ¸¸æˆé…ç½®</h2>
            
            <div class="form-group">
                <label for="gridSize">ç½‘æ ¼å¤§å°:</label>
                <select id="gridSize">
                    <option value="10">10Ã—10</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="planeCount">é£æœºæ•°é‡:</label>
                <input type="number" id="planeCount" min="1" max="5" value="3">
            </div>
            
            <h2>å·²çŸ¥ä¿¡æ¯</h2>
            
            <div class="form-group">
                <label for="hitType">é€‰æ‹©ç‚¹å‡»ç±»å‹:</label>
                <select id="hitType">
                    <option value="miss">æœªå‡»ä¸­ (â—¯)</option>
                    <option value="body">å‡»ä¸­æœºèº« (âœ–)</option>
                    <option value="head">å‡»ä¸­æœºå¤´ (ğŸ’¥)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ç‚¹å‡»ç½‘æ ¼è®¾ç½®å·²çŸ¥ä¿¡æ¯:</label>
                <div class="instructions">
                    <p><strong>å·¦é”®ç‚¹å‡»</strong>: è®¾ç½®å½“å‰é€‰æ‹©çš„ç‚¹å‡»ç±»å‹</p>
                    <p><strong>å³é”®ç‚¹å‡»</strong>: æ¸…é™¤è¯¥æ ¼å­çš„çŠ¶æ€</p>
                </div>
            </div>
            
            <div class="auto-refresh">
                <input type="checkbox" id="autoRefresh" checked>
                <label for="autoRefresh">å®æ—¶åˆ·æ–°æ¦‚ç‡</label>
            </div>
            
            <button id="calculateBtn">è®¡ç®—æ¦‚ç‡</button>
            <button id="resetBtn">é‡ç½®</button>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff9999;"></div>
                    <span>å‡»ä¸­æœºèº«</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff3333;"></div>
                    <span>å‡»ä¸­æœºå¤´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #cccccc;"></div>
                    <span>æœªå‡»ä¸­</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #99ff99;"></div>
                    <span>é«˜æ¦‚ç‡ä½ç½®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ff9900;"></div>
                    <span>å¯èƒ½æœºå¤´ä½ç½®</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="border: 2px solid #3366ff;"></div>
                    <span>æ¨èæ’ç‚¹åŒºåŸŸ</span>
                </div>
            </div>
        </div>
        
        <div class="grid-container">
            <h2>æ¦‚ç‡ç½‘æ ¼</h2>
            <div class="coordinates" id="grid"></div>
        </div>
    </div>
    
    <div class="info-panel">
        <h2>åˆ†æç»“æœ</h2>
        <div id="analysisResult">
            <p>ç‚¹å‡»"è®¡ç®—æ¦‚ç‡"æŒ‰é’®æŸ¥çœ‹åˆ†æç»“æœ</p>
        </div>
        <div id="recommendations" class="recommendation-list"></div>
    </div>

    <script>
        // ä¿®æ­£çš„é£æœºå½¢çŠ¶å®šä¹‰ - å£«å­—å½¢
        const PLANE_SHAPES = {
            up: [
                [0, 0],  // æœºå¤´ (1æ ¼)
                [-2, 1], [-1, 1], [0, 1], [1, 1], [2, 1],  // ç¬¬äºŒæ’ (5æ ¼)
                [0, 2],  // ç¬¬ä¸‰æ’ (1æ ¼)
                [-1, 3], [0, 3], [1, 3]  // ç¬¬å››æ’ (3æ ¼)
            ],
            down: [
                [0, 0],
                [-2, -1], [-1, -1], [0, -1], [1, -1], [2, -1],
                [0, -2],
                [-1, -3], [0, -3], [1, -3]
            ],
            left: [
                [0, 0],
                [1, -2], [1, -1], [1, 0], [1, 1], [1, 2],
                [2, 0],
                [3, -1], [3, 0], [3, 1]
            ],
            right: [
                [0, 0],
                [-1, -2], [-1, -1], [-1, 0], [-1, 1], [-1, 2],
                [-2, 0],
                [-3, -1], [-3, 0], [-3, 1]
            ]
        };

        // æ¸¸æˆçŠ¶æ€
        let gridSize = 10;
        let planeCount = 3;
        let gridState = []; // 0:æœªçŸ¥, 1:æœªå‡»ä¸­, 2:å‡»ä¸­æœºèº«, 3:å‡»ä¸­æœºå¤´
        let probabilityGrid = [];
        let headProbabilityGrid = []; // æœºå¤´æ¦‚ç‡
        let autoRefresh = true;

        // åˆå§‹åŒ–ç½‘æ ¼
        function initializeGrid() {
            gridState = Array(gridSize * gridSize).fill(0);
            probabilityGrid = Array(gridSize * gridSize).fill(0);
            headProbabilityGrid = Array(gridSize * gridSize).fill(0);
            
            const gridElement = document.getElementById('grid');
            gridElement.innerHTML = '';
            
            // åˆ›å»ºåæ ‡æ ‡ç­¾
            for (let i = 0; i <= gridSize; i++) {
                for (let j = 0; j <= gridSize; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'coordinate-cell';
                    
                    if (i === 0 && j === 0) {
                        // å·¦ä¸Šè§’ç©ºå•å…ƒæ ¼
                        cell.textContent = '';
                    } else if (i === 0) {
                        // é¡¶éƒ¨åæ ‡
                        cell.textContent = String.fromCharCode(64 + j);
                    } else if (j === 0) {
                        // å·¦ä¾§åæ ‡
                        cell.textContent = i;
                    } else {
                        // æ¸¸æˆç½‘æ ¼å•å…ƒæ ¼
                        const index = (i-1) * gridSize + (j-1);
                        cell.className = 'cell';
                        cell.dataset.index = index;
                        
                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                        cell.addEventListener('click', (e) => {
                            e.preventDefault();
                            handleCellClick(index);
                        });
                        
                        // æ·»åŠ å³é”®äº‹ä»¶
                        cell.addEventListener('contextmenu', (e) => {
                            e.preventDefault();
                            handleCellRightClick(index);
                        });
                        
                        // æ·»åŠ æ¦‚ç‡å€¼æ˜¾ç¤º
                        const valueDisplay = document.createElement('div');
                        valueDisplay.className = 'probability-value';
                        valueDisplay.id = `value-${index}`;
                        cell.appendChild(valueDisplay);
                        
                        // æ·»åŠ æœºå¤´æ ‡è®°
                        const headMarker = document.createElement('div');
                        headMarker.className = 'head-marker';
                        headMarker.id = `head-${index}`;
                        headMarker.style.display = 'none';
                        cell.appendChild(headMarker);
                        
                        // æ·»åŠ æ¦‚ç‡æŒ‡ç¤ºå™¨ï¼ˆæ–¹æ¡†ï¼‰
                        const indicator = document.createElement('div');
                        indicator.className = 'probability-indicator';
                        indicator.id = `indicator-${index}`;
                        cell.appendChild(indicator);
                        
                        // æ·»åŠ æ¨èåŒºåŸŸæ ‡è®°
                        const recommendedArea = document.createElement('div');
                        recommendedArea.className = 'recommended-area';
                        recommendedArea.id = `recommended-${index}`;
                        recommendedArea.style.display = 'none';
                        cell.appendChild(recommendedArea);
                    }
                    
                    gridElement.appendChild(cell);
                }
            }
            
            updateGridDisplay();
        }

        // å¤„ç†å•å…ƒæ ¼å·¦é”®ç‚¹å‡»
        function handleCellClick(index) {
            const hitType = document.getElementById('hitType').value;
            
            if (hitType === 'miss') {
                gridState[index] = 1;
            } else if (hitType === 'body') {
                gridState[index] = 2;
            } else if (hitType === 'head') {
                gridState[index] = 3;
            }
            
            updateGridDisplay();
            
            // å¦‚æœå¯ç”¨è‡ªåŠ¨åˆ·æ–°ï¼Œåˆ™é‡æ–°è®¡ç®—æ¦‚ç‡
            if (autoRefresh) {
                calculateProbabilities();
            }
        }

        // å¤„ç†å•å…ƒæ ¼å³é”®ç‚¹å‡»
        function handleCellRightClick(index) {
            gridState[index] = 0;
            updateGridDisplay();
            
            // å¦‚æœå¯ç”¨è‡ªåŠ¨åˆ·æ–°ï¼Œåˆ™é‡æ–°è®¡ç®—æ¦‚ç‡
            if (autoRefresh) {
                calculateProbabilities();
            }
        }

        // æ›´æ–°ç½‘æ ¼æ˜¾ç¤º
        function updateGridDisplay() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const index = parseInt(cell.dataset.index);
                const state = gridState[index];
                
                // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
                cell.classList.remove('miss', 'hit', 'head-hit');
                
                // æ·»åŠ ç›¸åº”çš„çŠ¶æ€ç±»
                if (state === 1) {
                    cell.classList.add('miss');
                } else if (state === 2) {
                    cell.classList.add('hit');
                } else if (state === 3) {
                    cell.classList.add('head-hit');
                }
                
                // æ›´æ–°æ¦‚ç‡æŒ‡ç¤ºå™¨ï¼ˆæ–¹æ¡†ï¼‰
                const indicator = document.getElementById(`indicator-${index}`);
                if (indicator) {
                    const probability = probabilityGrid[index];
                    const intensity = Math.min(probability * 2, 1);
                    indicator.style.borderColor = `rgba(0, 255, 0, ${intensity})`;
                    indicator.style.backgroundColor = `rgba(0, 255, 0, ${intensity * 0.2})`;
                }
                
                // æ›´æ–°æ¦‚ç‡å€¼æ˜¾ç¤º
                const valueDisplay = document.getElementById(`value-${index}`);
                if (valueDisplay) {
                    if (probabilityGrid[index] > 0) {
                        valueDisplay.textContent = `${Math.round(probabilityGrid[index] * 100)}%`;
                    } else {
                        valueDisplay.textContent = '';
                    }
                }
                
                // æ›´æ–°æœºå¤´æ ‡è®° - åªè¦æœ‰å¯èƒ½å°±æ ‡å‡ºæ¥ï¼Œä¸è®ºæ˜¯å¦å·²ç»æ‰“è¿‡
                const headMarker = document.getElementById(`head-${index}`);
                if (headMarker) {
                    if (headProbabilityGrid[index] > 0) {
                        headMarker.style.display = 'block';
                        // æ ¹æ®æœºå¤´æ¦‚ç‡è°ƒæ•´æ ‡è®°å¤§å°
                        const size = 6 + Math.min(headProbabilityGrid[index] * 10, 6);
                        headMarker.style.width = `${size}px`;
                        headMarker.style.height = `${size}px`;
                    } else {
                        headMarker.style.display = 'none';
                    }
                }
                
                // æ›´æ–°æ¨èåŒºåŸŸæ ‡è®°
                const recommendedArea = document.getElementById(`recommended-${index}`);
                if (recommendedArea) {
                    recommendedArea.style.display = 'none';
                }
            });
        }

        // è®¡ç®—é£æœºæ”¾ç½®çš„æ‰€æœ‰å¯èƒ½ä½ç½®
        function calculateProbabilities() {
            // é‡ç½®æ¦‚ç‡ç½‘æ ¼
            probabilityGrid.fill(0);
            headProbabilityGrid.fill(0);
            
            // è·å–é£æœºæ•°é‡
            planeCount = parseInt(document.getElementById('planeCount').value);
            
            // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„é£æœºä½ç½®ç»„åˆ
            const allPlacementCombinations = generateAllPlacementCombinations(planeCount);
            
            // è¿‡æ»¤ç¬¦åˆå½“å‰æ¸¸æˆçŠ¶æ€çš„æ”¾ç½®æ–¹å¼
            const validCombinations = allPlacementCombinations.filter(combination => 
                isValidPlacementCombination(combination)
            );
            
            if (validCombinations.length === 0) {
                document.getElementById('analysisResult').innerHTML = 
                    '<p style="color: red;">æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„é£æœºæ”¾ç½®æ–¹å¼ï¼Œè¯·æ£€æŸ¥å·²çŸ¥ä¿¡æ¯è®¾ç½®ã€‚</p>';
                document.getElementById('recommendations').innerHTML = '';
                return;
            }
            
            // è®¡ç®—æ¯ä¸ªæ ¼å­çš„æ¦‚ç‡
            validCombinations.forEach(combination => {
                // éå†ç»„åˆä¸­çš„æ¯æ¶é£æœº
                combination.forEach(placement => {
                    placement.cells.forEach(cellIndex => {
                        probabilityGrid[cellIndex] += 1;
                    });
                    
                    // è®°å½•æœºå¤´ä½ç½®
                    headProbabilityGrid[placement.headIndex] += 1;
                });
            });
            
            // è½¬æ¢ä¸ºæ¦‚ç‡ï¼ˆ0-1ï¼‰
            probabilityGrid = probabilityGrid.map(p => p / (validCombinations.length * planeCount));
            headProbabilityGrid = headProbabilityGrid.map(p => p / validCombinations.length);
            
            // æ›´æ–°æ˜¾ç¤º
            updateGridDisplay();
            
            // æ˜¾ç¤ºåˆ†æç»“æœ
            displayAnalysisResults(validCombinations.length);
            
            // è®¡ç®—å¹¶æ˜¾ç¤ºæ¨èæ’ç‚¹åŒºåŸŸ
            calculateRecommendedAreas();
        }

        // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å•æ¶é£æœºä½ç½®
        function generateAllSinglePlacements() {
            const placements = [];
            
            // éå†æ‰€æœ‰å¯èƒ½çš„æœºå¤´ä½ç½®å’Œæ–¹å‘
            for (let x = 0; x < gridSize; x++) {
                for (let y = 0; y < gridSize; y++) {
                    for (const direction in PLANE_SHAPES) {
                        const shape = PLANE_SHAPES[direction];
                        const planeCells = [];
                        let valid = true;
                        
                        // æ£€æŸ¥é£æœºæ˜¯å¦å®Œå…¨åœ¨ç½‘æ ¼å†…
                        for (const offset of shape) {
                            const cellX = x + offset[0];
                            const cellY = y + offset[1];
                            
                            if (cellX < 0 || cellX >= gridSize || cellY < 0 || cellY >= gridSize) {
                                valid = false;
                                break;
                            }
                            
                            planeCells.push(cellY * gridSize + cellX);
                        }
                        
                        if (valid) {
                            // æœºå¤´æ˜¯ç¬¬ä¸€ä¸ªæ ¼å­
                            const headIndex = y * gridSize + x;
                            placements.push({
                                cells: planeCells,
                                headIndex: headIndex,
                                direction: direction
                            });
                        }
                    }
                }
            }
            
            return placements;
        }

        // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„é£æœºä½ç½®ç»„åˆ
        function generateAllPlacementCombinations(count) {
            const singlePlacements = generateAllSinglePlacements();
            const combinations = [];
            
            // é€’å½’ç”Ÿæˆç»„åˆ
            function generateCombinations(current, start) {
                if (current.length === count) {
                    combinations.push([...current]);
                    return;
                }
                
                for (let i = start; i < singlePlacements.length; i++) {
                    const placement = singlePlacements[i];
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸å½“å‰ç»„åˆä¸­çš„é£æœºé‡å 
                    let overlaps = false;
                    for (const existing of current) {
                        if (placementOverlaps(existing, placement)) {
                            overlaps = true;
                            break;
                        }
                    }
                    
                    if (!overlaps) {
                        current.push(placement);
                        generateCombinations(current, i + 1);
                        current.pop();
                    }
                }
            }
            
            generateCombinations([], 0);
            return combinations;
        }

        // æ£€æŸ¥ä¸¤æ¶é£æœºæ˜¯å¦é‡å 
        function placementOverlaps(placement1, placement2) {
            for (const cell1 of placement1.cells) {
                for (const cell2 of placement2.cells) {
                    if (cell1 === cell2) {
                        return true;
                    }
                }
            }
            return false;
        }

        // æ£€æŸ¥é£æœºæ”¾ç½®ç»„åˆæ˜¯å¦æœ‰æ•ˆï¼ˆç¬¦åˆå·²çŸ¥ä¿¡æ¯ï¼‰
        function isValidPlacementCombination(combination) {
            // æ£€æŸ¥æ¯ä¸ªå•å…ƒæ ¼æ˜¯å¦ä¸å·²çŸ¥ä¿¡æ¯å†²çª
            for (let i = 0; i < gridState.length; i++) {
                const state = gridState[i];
                let covered = false;
                let isHead = false;
                
                // æ£€æŸ¥æ˜¯å¦è¢«ä»»ä½•é£æœºè¦†ç›–
                for (const placement of combination) {
                    if (placement.cells.includes(i)) {
                        covered = true;
                        if (placement.headIndex === i) {
                            isHead = true;
                        }
                    }
                }
                
                // å¦‚æœè¯¥ä½ç½®å·²çŸ¥æœªå‡»ä¸­ï¼Œä½†è¢«é£æœºè¦†ç›–ï¼Œåˆ™æ— æ•ˆ
                if (state === 1 && covered) return false;
                
                // å¦‚æœè¯¥ä½ç½®å·²çŸ¥å‡»ä¸­æœºå¤´ï¼Œä½†ä¸æ˜¯ä»»ä½•é£æœºçš„æœºå¤´ï¼Œåˆ™æ— æ•ˆ
                if (state === 3 && !isHead) return false;
                
                // å¦‚æœè¯¥ä½ç½®å·²çŸ¥å‡»ä¸­æœºèº«ï¼Œä½†æ²¡æœ‰è¢«ä»»ä½•é£æœºè¦†ç›–ï¼Œåˆ™æ— æ•ˆ
                if (state === 2 && !covered) return false;
            }
            
            return true;
        }

        // è®¡ç®—æ¨èæ’ç‚¹åŒºåŸŸ
        function calculateRecommendedAreas() {
            // æ‰¾å‡ºæ¦‚ç‡æœ€æ¥è¿‘50%çš„æ ¼å­
            let bestPositions = [];
            let bestScore = Infinity;
            
            for (let i = 0; i < probabilityGrid.length; i++) {
                // åªè€ƒè™‘æœªçŸ¥çš„å•å…ƒæ ¼
                if (gridState[i] !== 0) continue;
                
                const score = Math.abs(probabilityGrid[i] - 0.5);
                if (score < bestScore) {
                    bestScore = score;
                    bestPositions = [i];
                } else if (score === bestScore) {
                    bestPositions.push(i);
                }
            }
            
            // æ ‡è®°æ¨èåŒºåŸŸ
            bestPositions.forEach(index => {
                const recommendedArea = document.getElementById(`recommended-${index}`);
                if (recommendedArea) {
                    recommendedArea.style.display = 'block';
                }
            });
            
            // åœ¨æ¨èåˆ—è¡¨ä¸­æ˜¾ç¤º
            const recommendationsElement = document.getElementById('recommendations');
            if (bestPositions.length > 0) {
                let recommendationsHTML = '<h3>æ¨èæ’ç‚¹åŒºåŸŸ:</h3>';
                bestPositions.forEach(index => {
                    const x = index % gridSize;
                    const y = Math.floor(index / gridSize);
                    const position = `${String.fromCharCode(65 + x)}${y + 1}`;
                    const probability = Math.round(probabilityGrid[index] * 100);
                    recommendationsHTML += `<div class="recommendation-item">${position} (æ¦‚ç‡: ${probability}%)</div>`;
                });
                recommendationsElement.innerHTML = recommendationsHTML;
            } else {
                recommendationsElement.innerHTML = '';
            }
        }

        // æ˜¾ç¤ºåˆ†æç»“æœ
        function displayAnalysisResults(validCombinationsCount) {
            const resultElement = document.getElementById('analysisResult');
            
            // æ‰¾åˆ°æœºå¤´æ¦‚ç‡æœ€é«˜çš„ä½ç½®
            let bestHeadPositions = [];
            let bestHeadScore = 0;
            
            for (let i = 0; i < headProbabilityGrid.length; i++) {
                // åªè€ƒè™‘æœªçŸ¥çš„å•å…ƒæ ¼
                if (gridState[i] !== 0) continue;
                
                if (headProbabilityGrid[i] > bestHeadScore) {
                    bestHeadScore = headProbabilityGrid[i];
                    bestHeadPositions = [i];
                } else if (headProbabilityGrid[i] === bestHeadScore) {
                    bestHeadPositions.push(i);
                }
            }
            
            // æ ¼å¼åŒ–ç»“æœ
            let resultHTML = `<p>æœ‰æ•ˆé£æœºæ”¾ç½®ç»„åˆ: ${validCombinationsCount}</p>`;
            
            if (bestHeadPositions.length > 0) {
                resultHTML += `<p>å¯èƒ½æœºå¤´ä½ç½®: `;
                const headPositionStrs = bestHeadPositions.map(index => {
                    const x = index % gridSize;
                    const y = Math.floor(index / gridSize);
                    return `${String.fromCharCode(65 + x)}${y + 1}`;
                });
                resultHTML += headPositionStrs.join(', ');
                resultHTML += ` (æ¦‚ç‡: ${Math.round(bestHeadScore * 100)}%)</p>`;
            }
            
            resultHTML += `<p>è“è‰²è¾¹æ¡†æ ‡è®°äº†æ¦‚ç‡æœ€æ¥è¿‘50%çš„ä½ç½®ï¼Œè¿™äº›ä½ç½®èƒ½æœ€æœ‰æ•ˆåœ°æ’é™¤é£æœºä½ç½®ã€‚</p>`;
            
            resultElement.innerHTML = resultHTML;
        }

        // é‡ç½®æ¸¸æˆçŠ¶æ€
        function resetGame() {
            gridState.fill(0);
            probabilityGrid.fill(0);
            headProbabilityGrid.fill(0);
            updateGridDisplay();
            document.getElementById('analysisResult').innerHTML = 
                '<p>ç‚¹å‡»"è®¡ç®—æ¦‚ç‡"æŒ‰é’®æŸ¥çœ‹åˆ†æç»“æœ</p>';
            document.getElementById('recommendations').innerHTML = '';
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initializeGrid();
            
            // è®¾ç½®è‡ªåŠ¨åˆ·æ–°é€‰é¡¹
            const autoRefreshCheckbox = document.getElementById('autoRefresh');
            autoRefreshCheckbox.addEventListener('change', function() {
                autoRefresh = this.checked;
            });
            
            document.getElementById('calculateBtn').addEventListener('click', calculateProbabilities);
            document.getElementById('resetBtn').addEventListener('click', resetGame);
            
            // åˆå§‹è®¡ç®—
            calculateProbabilities();
        });
    </script>
</body>
</html>
