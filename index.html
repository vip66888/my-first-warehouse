<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>æ–°æ˜¥åˆ®åˆ®ä¹ Â· å‰æ•°ä¸“åœº</title>
  <style>
    /* æ ·å¼ä¿æŒä¸å˜ï¼Œç•¥ (å¯ä¿ç•™ä¹‹å‰å®Œæ•´æ ·å¼) */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Microsoft YaHei", sans-serif;
    }

    body {
      background: linear-gradient(145deg, #9d1f1f, #d32f2f);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }

    .container {
      max-width: 420px;
      width: 100%;
      margin: 0 auto;
      padding: 18px 16px 24px;
      text-align: center;
      background: rgba(255, 240, 200, 0.15);
      backdrop-filter: blur(2px);
      border-radius: 36px 36px 24px 24px;
      box-shadow: 0 15px 25px rgba(0,0,0,0.3);
    }

    .title {
      font-size: 32px;
      color: #ffec40;
      text-shadow: 0 0 12px #ffb300, 2px 4px 6px #b33e3e;
      margin: 0 0 10px;
      letter-spacing: 4px;
      animation: bounce 1.8s infinite ease-in-out;
    }

    .luck-text {
      color: #fff5b0;
      font-size: 18px;
      font-weight: 500;
      margin: -5px 0 18px;
      text-shadow: 0 2px 6px #a00;
      background: rgba(180, 40, 40, 0.4);
      display: inline-block;
      padding: 6px 20px;
      border-radius: 40px;
      backdrop-filter: blur(4px);
    }

    .info-box {
      background: rgba(255, 255, 245, 0.96);
      border-radius: 60px;
      padding: 12px 20px;
      margin-bottom: 20px;
      box-shadow: 0 6px 0 #992222, 0 8px 14px rgba(0,0,0,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #ffcf8a;
    }

    .coin {
      font-size: 22px;
      font-weight: 800;
      color: #b52727;
      background: #fff1b8;
      padding: 5px 16px;
      border-radius: 50px;
      box-shadow: inset 0 -2px 0 #cb7b3b;
    }

    .device {
      font-size: 14px;
      color: #5f3e3e;
      background: #ffe3c9;
      padding: 5px 14px;
      border-radius: 40px;
      font-weight: 500;
    }

    .lottery-card {
      width: 100%;
      aspect-ratio: 420 / 220;
      background: #fff2d7;
      border-radius: 24px;
      position: relative;
      margin: 15px auto 8px;
      box-shadow: 0 10px 0 #8b2a2a, 0 12px 20px #3d1b1b;
      overflow: hidden;
      border: 2px solid #ffc857;
    }

    .scratch-area {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: grab;
      z-index: 10;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }

    .prize-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 58px;
      font-weight: 800;
      color: #da3e3e;
      background: #fffef7;
      z-index: 1;
      border-radius: 22px;
      box-shadow: inset 0 0 0 3px #f9d56b;
    }

    .prize-text {
      font-size: 20px;
      margin-top: 8px;
      color: #b33737;
      background: #fff1bb;
      padding: 4px 16px;
      border-radius: 40px;
      font-weight: 600;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin: 12px 0 10px;
    }

    .btn {
      flex: 1;
      background: linear-gradient(170deg, #ffdb7c, #ffb347);
      border: none;
      padding: 14px 0;
      border-radius: 60px;
      font-size: 20px;
      font-weight: bold;
      color: #7a2222;
      cursor: pointer;
      box-shadow: 0 6px 0 #b4622a, 0 6px 12px black;
      transition: 0.08s linear;
      border: 1px solid #ffdb8a;
      letter-spacing: 1px;
    }

    .btn-exchange {
      background: linear-gradient(170deg, #fe7171, #c13b3b);
      color: #fffbd0;
      box-shadow: 0 6px 0 #812525, 0 6px 12px #360000;
    }

    .btn:active:not(:disabled) {
      transform: translateY(4px);
      box-shadow: 0 2px 0 #b4622a, 0 6px 12px black;
    }

    .btn-exchange:active:not(:disabled) {
      transform: translateY(4px);
      box-shadow: 0 2px 0 #812525, 0 6px 12px #360000;
    }

    .btn:disabled {
      background: #b3b3b3;
      color: #4f4f4f;
      box-shadow: 0 4px 0 #6e6e6e;
      border-color: #9c9c9c;
      pointer-events: none;
      opacity: 0.5;
    }

    .log-box {
      background: rgba(255, 250, 235, 0.95);
      border-radius: 22px;
      padding: 14px 14px 10px;
      margin-top: 24px;
      max-height: 230px;
      overflow-y: auto;
      text-align: left;
      font-size: 14px;
      border: 2px solid #fdcb6e;
      box-shadow: inset 0 2px 6px #ab5c5c;
    }

    .log-title {
      font-weight: 800;
      margin-bottom: 10px;
      color: #b71c1c;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
      border-bottom: 2px dashed #d6995a;
      padding-bottom: 4px;
    }

    .log-item {
      padding: 6px 4px;
      border-bottom: 1px solid #eedbaa;
      display: flex;
      justify-content: space-between;
      font-size: 15px;
    }

    .income {
      color: #c44949;
      font-weight: 700;
      background: #ffebc0;
      padding: 2px 12px;
      border-radius: 20px;
    }

    .outcome {
      color: #4f3a2b;
      background: #ddd3c0;
      padding: 2px 12px;
      border-radius: 20px;
    }

    .odds {
      color: #fbe593;
      margin-top: 20px;
      font-size: 13px;
      background: rgba(90, 20, 20, 0.5);
      padding: 8px 14px;
      border-radius: 60px;
      backdrop-filter: blur(2px);
      line-height: 1.6;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .log-box::-webkit-scrollbar {
      width: 6px;
    }
    .log-box::-webkit-scrollbar-thumb {
      background: #d35454;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">ğŸ´ é©¬å¹´åˆ®åˆ®ä¹ ğŸ´</h1>
    <div class="luck-text">ğŸ® å‰æ•°ä¸“åœº Â· æ‰‹åŠ¨å…‘å¥– ğŸ®</div>

    <div class="info-box">
      <div class="coin">ğŸ’° <span id="coin">--</span></div>
      <div class="device">ğŸ†” <span id="deviceId"></span></div>
    </div>

    <div class="lottery-card">
      <div class="prize-content" id="prizeContent">
        ğŸ’°
        <div class="prize-text">è¯·ç‚¹ã€æ–°åˆ®åˆ®å¡ã€‘</div>
      </div>
      <canvas class="scratch-area" id="scratchCanvas"></canvas>
    </div>

    <div class="btn-group">
      <button class="btn" id="newCard" onclick="window.newCard()">ğŸ« æ–°åˆ®å¡ Â· 50</button>
      <button class="btn btn-exchange" id="exchangeBtn" onclick="window.exchangeCoin()">ğŸ’° ä¸€é”®å…‘å¥–</button>
    </div>

    <div class="log-box">
      <div class="log-title">ğŸ“‹ æ”¶æ”¯æµæ°´</div>
      <div id="logList"></div>
    </div>

    <div class="odds">
      ğŸ² ä¸­å¥–ç‡68.2% Â· æœŸæœ›è¿”å¥–53 (å•æ¬¡æ¶ˆè´¹50)<br>
      å¥–é¡¹åˆ†å¸ƒï¼š28é‡‘(5%) Â· 58é‡‘(5%) Â· 66é‡‘(45%) Â· 88é‡‘(10%) Â· 168é‡‘(2%) Â· 518é‡‘(1%) Â· 666é‡‘(0.1%) Â· 888é‡‘(0.05%) Â· 66888é‡‘(0.001%) Â· è°¢è°¢(31.8%)<br>
      âœ¨ åˆ®å¼€10%å³å¯å…‘å¥–ï¼Œå…‘å¥–åå¡ç‰‡ä¿ç•™
    </div>
  </div>

  <script>
    (function() {
      // ----- æ ¸å¿ƒå˜é‡ -----
      const canvas = document.getElementById('scratchCanvas');
      const ctx = canvas.getContext('2d');
      const coinEl = document.getElementById('coin');
      const deviceEl = document.getElementById('deviceId');
      const prizeContent = document.getElementById('prizeContent');
      const newCardBtn = document.getElementById('newCard');
      const exchangeBtn = document.getElementById('exchangeBtn');
      const logList = document.getElementById('logList');

      let width, height;
      let isScratching = false;
      
      // æ¸¸æˆçŠ¶æ€
      let coins = 2000;                  // åˆå§‹å€¼ï¼Œä¼šè¢«æœ¬åœ°å­˜å‚¨è¦†ç›–
      let isCardActive = false;           // æ˜¯å¦æœ‰æ¿€æ´»çš„å¡ç‰‡
      let prize = 0;                      // å½“å‰å¡ç‰‡å¥–é‡‘
      let hasWin = false;                 // æ˜¯å¦å·²åˆ®å¼€è¶…è¿‡10% (å¯å…‘å¥–)
      let redeemed = false;               // å½“å‰å¡ç‰‡æ˜¯å¦å·²å…‘å¥–

      // æ—¥å¿—æ•°ç»„ (å­˜å‚¨HTMLå­—ç¬¦ä¸²)
      let logEntries = [];

      // ----- è®¾å¤‡ID (å”¯ä¸€æ ‡è¯†) -----
      function getDeviceId() {
        let id = localStorage.getItem('lottery_device_id');
        if (!id) {
          id = 'dev_' + Math.random().toString(36).substr(2, 10);
          localStorage.setItem('lottery_device_id', id);
        }
        return id;
      }
      deviceEl.innerText = getDeviceId().substr(-4);

      // ----- ä¿å­˜å…¨éƒ¨çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨ -----
      function saveGameState() {
        // ä¿å­˜åŸºç¡€æ•°æ®
        localStorage.setItem('lottery_coins', coins);
        localStorage.setItem('lottery_isCardActive', isCardActive ? '1' : '0');
        localStorage.setItem('lottery_prize', prize);
        localStorage.setItem('lottery_hasWin', hasWin ? '1' : '0');
        localStorage.setItem('lottery_redeemed', redeemed ? '1' : '0');
        // ä¿å­˜æ—¥å¿—æ•°ç»„ (è½¬ä¸ºJSONå­—ç¬¦ä¸²)
        localStorage.setItem('lottery_logEntries', JSON.stringify(logEntries));
      }

      // ----- åŠ è½½å…¨éƒ¨çŠ¶æ€ -----
      function loadGameState() {
        // é‡‘å¸
        let savedCoins = localStorage.getItem('lottery_coins');
        if (savedCoins !== null) {
          coins = parseInt(savedCoins, 10);
          if (isNaN(coins)) coins = 2000;
        } else {
          coins = 2000;
        }
        coinEl.innerText = coins;

        // å¡ç‰‡çŠ¶æ€
        isCardActive = localStorage.getItem('lottery_isCardActive') === '1';
        prize = parseInt(localStorage.getItem('lottery_prize') || '0', 10);
        hasWin = localStorage.getItem('lottery_hasWin') === '1';
        redeemed = localStorage.getItem('lottery_redeemed') === '1';

        // æ—¥å¿—
        let savedLog = localStorage.getItem('lottery_logEntries');
        if (savedLog) {
          try {
            logEntries = JSON.parse(savedLog);
            // ç¡®ä¿æ˜¯æ•°ç»„
            if (!Array.isArray(logEntries)) logEntries = [];
          } catch (e) {
            logEntries = [];
          }
        } else {
          logEntries = [];
        }
        // é‡æ–°æ¸²æŸ“æ—¥å¿—
        logList.innerHTML = logEntries.join('');
      }

      // ----- æ—¥å¿—è®°å½• (åªè®°å½• -50 å’Œ +xx) -----
      function addLog(text, type, amount = '') {
        const now = new Date();
        const time = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
        let displayText = '';
        if (type === 'outcome' && amount === '50') {
          displayText = `è´­ä¹°åˆ®åˆ®å¡ -50`;
        } else if (type === 'income' && amount) {
          displayText = `ä¸­å¥– +${amount}`;
        } else {
          return;
        }
        const logHtml = `<div class="log-item">
          <span>${time} ${displayText}</span>
          <span class="${type}">${type === 'income' ? '+' : 'âˆ’'}</span>
        </div>`;
        logEntries.unshift(logHtml);
        if (logEntries.length > 30) logEntries.pop();
        logList.innerHTML = logEntries.join('');
        saveGameState(); // çŠ¶æ€å˜åŒ–ç«‹å³ä¿å­˜
      }

      // ----- å¥–é‡‘ç”Ÿæˆ (å‰æ•°é›†åˆ) ä¿®æ”¹æ­¤å¤„ï¼šå¢åŠ æ¬¾å¼ã€è°ƒé«˜é‡‘é¢ã€æ¦‚ç‡å˜å¤§ -----
      function generatePrize() {
        const r = Math.random();
        // ç´¯è®¡æ¦‚ç‡ (æ€»ä¸­å¥–ç‡çº¦68.2%ï¼ŒæœŸæœ›çº¦53)
        if (r < 0.05) {
          prize = 28;
          return '28é‡‘å¸';
        } else if (r < 0.10) {
          prize = 58;
          return '58é‡‘å¸';
        } else if (r < 0.55) {
          prize = 66;
          return '66é‡‘å¸';
        } else if (r < 0.65) {
          prize = 88;
          return '88é‡‘å¸';
        } else if (r < 0.67) {
          prize = 168;
          return '168é‡‘å¸';
        } else if (r < 0.68) {
          prize = 518;
          return '518é‡‘å¸';
        } else if (r < 0.681) {
          prize = 666;
          return '666é‡‘å¸';
        } else if (r < 0.6815) {
          prize = 888;
          return '888é‡‘å¸';
        } else if (r < 0.68151) {
          prize = 66888;
          return '66888é‡‘å¸';
        } else {
          prize = 0;
          return 'è°¢è°¢å‚ä¸';
        }
      }

      // ----- è°ƒæ•´ç”»å¸ƒå°ºå¯¸ -----
      function updateCanvasSize() {
        const rect = canvas.getBoundingClientRect();
        if (rect.width === 0 || rect.height === 0) return;
        canvas.width = rect.width;
        canvas.height = rect.height;
        width = canvas.width;
        height = canvas.height;
      }

      // ----- ç»˜åˆ¶æ¶‚å±‚ (ç°è‰²) -----
      function drawCoating() {
        if (!width || !height) updateCanvasSize();
        ctx.clearRect(0, 0, width, height);
        ctx.fillStyle = '#9c7c5b';
        ctx.fillRect(0, 0, width, height);
        // å¢åŠ è´¨æ„Ÿ
        ctx.fillStyle = '#bda16f';
        for (let i = 0; i < 20; i++) {
          ctx.beginPath();
          ctx.arc(Math.random() * width, Math.random() * height, 3, 0, 2*Math.PI);
          ctx.fill();
        }
        ctx.fillStyle = '#f9f3d9';
        ctx.font = 'bold 24px "Microsoft YaHei", sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('ğŸ‘† åˆ®å¼€æœ‰å–œ', width / 2, height / 2 - 8);
        ctx.font = '18px sans-serif';
        ctx.fillText('é©¬å¹´è¡Œå¤§è¿', width / 2, height / 2 + 24);
      }

      // ----- ç»˜åˆ¶åˆå§‹æç¤º (æœªè´­ä¹°æ—¶æ˜¾ç¤º) -----
      function drawInitialHint() {
        if (!width || !height) updateCanvasSize();
        ctx.clearRect(0, 0, width, height);
        ctx.fillStyle = '#d6c7a8';
        ctx.fillRect(0, 0, width, height);
        ctx.fillStyle = '#7a4d4d';
        ctx.font = 'bold 22px "Microsoft YaHei", sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('è¯·å…ˆç‚¹å‡»', width / 2, height / 2 - 15);
        ctx.fillText('ã€æ–°åˆ®åˆ®å¡ã€‘', width / 2, height / 2 + 15);
      }

      // ----- æ ¹æ®å½“å‰çŠ¶æ€åˆ·æ–°ç•Œé¢ (æ¶‚å±‚ã€å¥–å“æ–‡å­—) -----
      function refreshUI() {
        // æ›´æ–°é‡‘å¸æ˜¾ç¤º
        coinEl.innerText = coins;

        // æ›´æ–°å¥–å“æ–‡å­—
        if (isCardActive) {
          if (prize > 0) {
            prizeContent.innerHTML = `ğŸ’°<div class="prize-text">æ­å–œè·å¾— ${prize}é‡‘å¸</div>`;
          } else {
            prizeContent.innerHTML = `ğŸ˜‰<div class="prize-text">è°¢è°¢å‚ä¸</div>`;
          }
        } else {
          prizeContent.innerHTML = `ğŸ’°<div class="prize-text">è¯·ç‚¹ã€æ–°åˆ®åˆ®å¡ã€‘</div>`;
        }

        // ç»˜åˆ¶æ¶‚å±‚æˆ–åˆå§‹æç¤º
        if (!isCardActive) {
          drawInitialHint();
        } else {
          drawCoating();  // æ¶‚å±‚å®Œæ•´ï¼Œåˆ®ç—•æ— æ³•æ¢å¤
        }
      }

      // ----- è´­ä¹°æ–°åˆ®åˆ®å¡ -----
      window.newCard = function() {
        if (coins < 50) {
          alert('é‡‘å¸ä¸è¶³ï¼Œå…ˆå…‘ä¸ªå¥–å§ ~');
          return;
        }
        coins -= 50;
        saveCoinsOnly(); // ä»…ä¿å­˜é‡‘å¸ï¼ˆä½†saveGameStateä¼šæ•´ä½“ä¿å­˜ï¼‰
        addLog('è´­ä¹°åˆ®åˆ®å¡', 'outcome', '50');

        const prizeText = generatePrize();        // è®¾ç½® prize
        // æ¿€æ´»å¡ç‰‡ï¼Œé‡ç½®çŠ¶æ€
        isCardActive = true;
        hasWin = false;
        redeemed = false;

        // åˆ·æ–°ç•Œé¢
        refreshUI();
        saveGameState();
      };

      // å•ç‹¬ä¿å­˜é‡‘å¸çš„è¾…åŠ©å‡½æ•°ï¼ˆç”¨äºæ‰£å‡åå¿«é€Ÿæ›´æ–°ï¼Œä½†åç»­saveGameStateä¼šç»Ÿä¸€ä¿å­˜ï¼‰
      function saveCoinsOnly() {
        coinEl.innerText = coins;
        // ä¸å•ç‹¬å­˜ï¼Œç­‰å¾…æ•´ä½“ä¿å­˜
      }

      // ----- åˆ®æ“¦çº¿æ¡ (ä»…å½“å¡ç‰‡æ¿€æ´»ä¸”æœªå…‘å¥–) -----
      function scratchLine(fromX, fromY, toX, toY) {
        if (!isCardActive || redeemed) return;    // æ— å¡ç‰‡æˆ–å·²å…‘å¥–ä¸å¯åˆ®
        if (!width || !height) updateCanvasSize();
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.lineWidth = 34;
        ctx.beginPath();
        ctx.moveTo(fromX, fromY);
        ctx.lineTo(toX, toY);
        ctx.stroke();
        ctx.globalCompositeOperation = 'source-over';
        checkScratchPercentage();
      }

      // ----- æ£€æŸ¥åˆ®å¼€é¢ç§¯æ˜¯å¦è¶…è¿‡10% -> æ ‡è®°ä¸ºå¯å…‘å¥–(hasWin=true) -----
      function checkScratchPercentage() {
        if (hasWin || !isCardActive || redeemed || !width || !height) return;
        const imgData = ctx.getImageData(0, 0, width, height).data;
        let cleared = 0;
        const total = width * height;
        for (let i = 3; i < imgData.length; i += 8) {
          if (imgData[i] < 10) cleared++;
        }
        const sampleTotal = Math.ceil(total / 2);
        if (cleared / sampleTotal > 0.1) {         // 10% å³å¯å…‘å¥–
          hasWin = true;
          saveGameState();                         // çŠ¶æ€å˜åŒ–ä¿å­˜
        }
      }

      // ----- ä¸€é”®å…‘å¥– -----
      window.exchangeCoin = function() {
        if (!isCardActive) {
          alert('è¯·å…ˆè´­ä¹°ä¸€å¼ åˆ®åˆ®å¡');
          return;
        }
        if (redeemed) {
          alert('æ­¤å¡å·²å…‘å¥–ï¼Œè¯·è´­ä¹°æ–°å¡');
          return;
        }
        if (!hasWin) {
          alert('è¯·å…ˆåˆ®å¼€å¡ç‰‡ï¼ˆè‡³å°‘åˆ®å¼€10%ï¼‰å†å…‘å¥–');
          return;
        }

        // å…‘å¥–
        if (prize > 0) {
          coins += prize;
          addLog('ä¸­å¥–', 'income', prize.toString());
        } else {
          alert('è°¢è°¢å‚ä¸ï¼Œå†æ¥å†å‰');
        }
        redeemed = true;
        saveGameState();                            // ä¿å­˜çŠ¶æ€
        // ç•Œé¢ä¸å˜ï¼ˆæ¶‚å±‚ä»å­˜åœ¨ï¼Œä½†å·²ç¦æ­¢å†æ¬¡å…‘å¥–ï¼‰
      };

      // ----- äº‹ä»¶ç»‘å®š (é¼ æ ‡/è§¦æ‘¸) -----
      let lastX = 0, lastY = 0;

      function handleStart(e) {
        e.preventDefault();
        if (!isCardActive || redeemed) return;      // æ— æ¿€æ´»å¡ç‰‡æˆ–å·²å…‘å¥–ä¸èƒ½åˆ®
        isScratching = true;
        const rect = canvas.getBoundingClientRect();
        const clientX = e.clientX ?? (e.touches ? e.touches[0].clientX : 0);
        const clientY = e.clientY ?? (e.touches ? e.touches[0].clientY : 0);
        lastX = clientX - rect.left;
        lastY = clientY - rect.top;
      }

      function handleMove(e) {
        e.preventDefault();
        if (!isScratching || !isCardActive || redeemed) return;
        const rect = canvas.getBoundingClientRect();
        const clientX = e.clientX ?? (e.touches ? e.touches[0].clientX : 0);
        const clientY = e.clientY ?? (e.touches ? e.touches[0].clientY : 0);
        const x = clientX - rect.left;
        const y = clientY - rect.top;
        if (x < 0 || y < 0 || x > width || y > height) {
          isScratching = false;
          return;
        }
        scratchLine(lastX, lastY, x, y);
        lastX = x;
        lastY = y;
      }

      function handleEnd(e) {
        e.preventDefault();
        isScratching = false;
      }

      canvas.addEventListener('mousedown', handleStart);
      canvas.addEventListener('mousemove', handleMove);
      canvas.addEventListener('mouseup', handleEnd);
      canvas.addEventListener('mouseleave', handleEnd);

      canvas.addEventListener('touchstart', handleStart, { passive: false });
      canvas.addEventListener('touchmove', handleMove, { passive: false });
      canvas.addEventListener('touchend', handleEnd);
      canvas.addEventListener('touchcancel', handleEnd);

      // ----- çª—å£å°ºå¯¸å˜åŒ–è‡ªé€‚åº” (ä¿ç•™çŠ¶æ€) -----
      let resizeTimer;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          updateCanvasSize();
          refreshUI();  // é‡ç»˜æ¶‚å±‚æˆ–æç¤º
        }, 100);
      });

      // ----- å¯åŠ¨åŠ è½½ -----
      window.onload = function() {
        loadGameState();          // ä»æœ¬åœ°å­˜å‚¨è¯»å–æ‰€æœ‰çŠ¶æ€
        updateCanvasSize();
        refreshUI();              // æ ¹æ®çŠ¶æ€ç»˜åˆ¶ç•Œé¢
      };

    })();
  </script>
</body>
</html>